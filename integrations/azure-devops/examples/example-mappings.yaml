deleteDependentEntities: true
createMissingRelatedEntities: true
resources:
  - kind: board
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: .id | gsub(" "; "")
          title: .name
          blueprint: '"board"'
          properties:
            link: .url
          relations:
            project: .__project.id | gsub(" "; "")
  - kind: column
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: .__stateType+"-"+.name+"-"+.__board.__project.id | gsub(" "; "")
          title: .name
          blueprint: '"column"'
          relations:
            board: .__board.id | gsub(" "; "")
  - kind: release
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: .id | tostring | gsub(" "; "")
          title: .name
          blueprint: '"release"'
          properties:
            status: .status
            reason: .reason
            createdDate: .createdOn
            modifiedDate: .modifiedOn
            createdBy: .createdBy.displayName
            modifiedBy: .modifiedBy.displayName
            tags: .tags
            link: ._links.web.href | gsub("_release?releaseId="; "")
          relations:
            project: .projectReference.id | gsub(" "; "")
  - kind: file
    selector:
      query: 'true'
      files:
        path: package.json
        repos:
          - my-node-app
          - my-react-app
    port:
      entity:
        mappings:
          identifier: .file.path | gsub(" "; "")
          title: .file.path
          blueprint: '"file"'
          properties:
            path: .file.path
            size: .file.size
            content: .file.content
            link: .repo.remoteUrl + "?path=" + (.file.path)
          relations:
            repository: >-
              "\(.repo.project.name | ascii_downcase | gsub("[ ();]";
              ""))/\(.repo.name | ascii_downcase | gsub("[ ();]"; ""))"
  - kind: file
    selector:
      query: 'true'
      files:
        path:
          - deployment/helm/values.yaml
          - docs/README.md
    port:
      entity:
        mappings:
          identifier: .file.path | gsub(" "; "")
          title: .file.path
          blueprint: '"file"'
          properties:
            path: .file.path
            size: .file.size
            content: .file.content
            link: .repo.remoteUrl + "?path=" + (.file.path)
          relations:
            repository: >-
              "\(.repo.project.name | ascii_downcase | gsub("[ ();]";
              ""))/\(.repo.name | ascii_downcase | gsub("[ ();]"; ""))"
  - kind: file
    selector:
      query: 'true'
      files:
        path:
          - package.json
          - package-lock.json
    port:
      entity:
        mappings:
          identifier: .file.objectId
          title: .file.path
          blueprint: '"file"'
          properties:
            path: .file.path
            size: .file.size
            content: .file.content
            link: .repo.remoteUrl + "?path=" + (.file.path)
          relations:
            repository: >-
              "\(.repo.project.name | ascii_downcase | gsub("[ ();]";
              ""))/\(.repo.name | ascii_downcase | gsub("[ ();]"; ""))"
  - kind: folder
    selector:
      repository_mappings:
        - repository_name: "main-monorepo"
          patterns:
            - path: "services/user-service/**"
              description: "User management microservice"
            - path: "services/payment-service/**"
              description: "Payment processing service"
            - path: "services/inventory-service/**"
              description: "Inventory management service"
            - path: "apps/customer-portal/**"
              description: "Customer-facing web application"
            - path: "apps/admin-dashboard/**"
              description: "Internal admin dashboard"
            - path: "libs/common-utils/**"
              description: "Shared utilities and helpers"
            - path: "infrastructure/kubernetes/**"
              description: "Kubernetes manifests and helm charts"
    port:
      entity:
        mappings:
          identifier: .path
          title: .path | split("/") | last
          blueprint: '"folder"'
          properties:
            path: .path
            description: .__patterns[0].description
            repository: .__repository.name
            lastModified: .lastModified
            size: .size
            type: "folder"
          relations:
            repository: >-
              "\(.__repository.project.name | ascii_downcase | gsub("[ ();]"; ""))/\(.__repository.name | ascii_downcase | gsub("[ ();]"; ""))"
